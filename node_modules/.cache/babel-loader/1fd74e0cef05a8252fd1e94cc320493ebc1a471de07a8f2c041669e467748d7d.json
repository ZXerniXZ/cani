{"ast":null,"code":"var _jsxFileName = \"/home/ares-desktop/localRepo/cani/mqtt-react-demo/src/App.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport mqtt from 'mqtt';\nimport './App.css';\nimport { richiediPermessoNotifiche } from './index';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MQTT_BROKER = 'wss://test.mosquitto.org:8081';\nconst TOPIC = 'giardino/stato';\nconst FAMIGLIE = ['Rossi', 'Bianchi'];\nconst VAPID_PUBLIC_KEY = 'BB8l__PCTsH5Xb1gaDl5pAO-XyrUJOCtD8JdJYyJhCxVacLalgk4dnWyHYkp3_q6yT8KVT4N2C3ziwGOA6tUcRQ';\nfunction formatDate(ts) {\n  const d = new Date(ts);\n  return d.toLocaleString();\n}\nfunction App() {\n  _s();\n  const [famiglia, setFamiglia] = useState('');\n  const [famigliaSelezionata, setFamigliaSelezionata] = useState(null);\n  const [stato, setStato] = useState(null);\n  const [conn, setConn] = useState('connecting');\n  const clientRef = useRef(null);\n\n  // Funzione per registrare la subscription push (placeholder, backend dopo)\n  async function registraPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        const sub = await reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n        // Invia la subscription al backend\n        await fetch('http://localhost:4000/subscribe', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(sub)\n        });\n        console.log('Push subscription inviata al backend:', JSON.stringify(sub));\n      } catch (e) {\n        console.warn('Push subscription error', e);\n      }\n    }\n  }\n\n  // Funzione di utilità per VAPID key\n  function urlBase64ToUint8Array(base64String) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n\n  // Recupera la famiglia selezionata da localStorage all'avvio\n  useEffect(() => {\n    const salvata = localStorage.getItem('famiglia');\n    if (salvata) {\n      setFamigliaSelezionata(salvata);\n      setFamiglia(salvata);\n    }\n  }, []);\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_BROKER);\n    clientRef.current = client;\n    client.on('connect', () => {\n      setConn('connected');\n      client.subscribe(TOPIC);\n    });\n    client.on('error', () => {\n      setConn('connecting'); // Riprova sempre\n    });\n    client.on('message', (topic, msg) => {\n      if (topic === TOPIC) {\n        try {\n          const data = JSON.parse(msg.toString());\n          if (data.stato && data.famiglia && data.timestamp) {\n            setStato(data);\n          }\n        } catch {}\n      }\n    });\n    return () => {\n      client.end();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const pubblicaStato = nuovoStato => {\n    if (clientRef.current && clientRef.current.connected && famigliaSelezionata) {\n      const payload = {\n        stato: nuovoStato,\n        famiglia: famigliaSelezionata,\n        timestamp: Date.now()\n      };\n      clientRef.current.publish(TOPIC, JSON.stringify(payload));\n      // Aggiornamento ottimistico locale\n      setStato(payload);\n    }\n  };\n  let boxClass = 'giardino-card';\n  let boxText = 'Giardino libero';\n  let infoText = '';\n  if (stato) {\n    if (stato.stato === 'occupato') {\n      boxClass += ' occupato';\n      boxText = 'Giardino occupato';\n      infoText = `Occupato da: ${stato.famiglia} dal ${formatDate(stato.timestamp)}`;\n    } else {\n      boxText = 'Giardino libero';\n      infoText = `Ultimo utilizzatore: ${stato.famiglia} (liberato il ${formatDate(stato.timestamp)})`;\n    }\n  }\n  if (conn !== 'connected') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: /*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"App-header\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 32,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative'\n          },\n          children: [\"Connessione al broker MQTT...\", /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: 24,\n              fontSize: 18,\n              color: '#aaa'\n            },\n            children: \"Attendere...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Schermata di selezione famiglia\n  if (!famigliaSelezionata) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: /*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"App-header\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 32\n            },\n            children: \"Seleziona la tua famiglia:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: famiglia,\n            onChange: e => setFamiglia(e.target.value),\n            style: {\n              fontSize: 22,\n              marginBottom: 24\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              disabled: true,\n              children: \"-- Scegli --\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this), FAMIGLIE.map(f => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: f,\n              children: f\n            }, f, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 34\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              fontSize: 20,\n              padding: '10px 24px'\n            },\n            disabled: !famiglia,\n            onClick: async () => {\n              setFamigliaSelezionata(famiglia);\n              localStorage.setItem('famiglia', famiglia);\n              const perm = await richiediPermessoNotifiche();\n              if (perm === 'granted') {\n                await registraPush();\n              }\n            },\n            children: \"Conferma\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"App-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Gestione Giardino\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: 24,\n          fontSize: 18,\n          color: '#fff'\n        },\n        children: [\"Famiglia selezionata: \", /*#__PURE__*/_jsxDEV(\"b\", {\n          children: famigliaSelezionata\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 16,\n          marginBottom: 32\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            fontSize: 18,\n            padding: '10px 24px'\n          },\n          onClick: () => pubblicaStato('occupato'),\n          disabled: (stato === null || stato === void 0 ? void 0 : stato.stato) === 'occupato' && (stato === null || stato === void 0 ? void 0 : stato.famiglia) === famigliaSelezionata || (stato === null || stato === void 0 ? void 0 : stato.stato) === 'occupato' && (stato === null || stato === void 0 ? void 0 : stato.famiglia) !== famigliaSelezionata,\n          children: \"Occupa giardino\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            fontSize: 18,\n            padding: '10px 24px'\n          },\n          onClick: () => pubblicaStato('libero'),\n          disabled: !((stato === null || stato === void 0 ? void 0 : stato.stato) === 'occupato' && (stato === null || stato === void 0 ? void 0 : stato.famiglia) === famigliaSelezionata),\n          children: \"Libera giardino\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: boxClass,\n        children: [boxText, /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"giardino-info\",\n          children: infoText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 32,\n          fontSize: 16,\n          color: '#aaa'\n        },\n        children: [\"Stato MQTT: \", conn === 'connected' ? 'Connesso' : conn === 'connecting' ? 'Connessione...' : 'Errore']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 203,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"QEsdSiroZQhhoK8oDe/+HAGirDk=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useRef","useState","mqtt","richiediPermessoNotifiche","jsxDEV","_jsxDEV","MQTT_BROKER","TOPIC","FAMIGLIE","VAPID_PUBLIC_KEY","formatDate","ts","d","Date","toLocaleString","App","_s","famiglia","setFamiglia","famigliaSelezionata","setFamigliaSelezionata","stato","setStato","conn","setConn","clientRef","registraPush","navigator","window","reg","serviceWorker","ready","sub","pushManager","subscribe","userVisibleOnly","applicationServerKey","urlBase64ToUint8Array","fetch","method","headers","body","JSON","stringify","console","log","e","warn","base64String","padding","repeat","length","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","salvata","localStorage","getItem","client","connect","current","on","topic","msg","data","parse","toString","timestamp","end","pubblicaStato","nuovoStato","connected","payload","now","publish","boxClass","boxText","infoText","className","children","style","background","color","borderRadius","width","height","display","flexDirection","alignItems","justifyContent","fontSize","fontWeight","margin","boxShadow","position","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","marginBottom","value","onChange","target","disabled","map","f","onClick","setItem","perm","gap","_c","$RefreshReg$"],"sources":["/home/ares-desktop/localRepo/cani/mqtt-react-demo/src/App.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport mqtt, { MqttClient } from 'mqtt';\nimport './App.css';\nimport { richiediPermessoNotifiche } from './index';\n\nconst MQTT_BROKER = 'wss://test.mosquitto.org:8081';\nconst TOPIC = 'giardino/stato';\nconst FAMIGLIE = ['Rossi', 'Bianchi'];\nconst VAPID_PUBLIC_KEY = 'BB8l__PCTsH5Xb1gaDl5pAO-XyrUJOCtD8JdJYyJhCxVacLalgk4dnWyHYkp3_q6yT8KVT4N2C3ziwGOA6tUcRQ';\n\ntype StatoGiardino = {\n  stato: 'libero' | 'occupato';\n  famiglia: string;\n  timestamp: number;\n};\n\nfunction formatDate(ts: number) {\n  const d = new Date(ts);\n  return d.toLocaleString();\n}\n\nfunction App() {\n  const [famiglia, setFamiglia] = useState<string>('');\n  const [famigliaSelezionata, setFamigliaSelezionata] = useState<string | null>(null);\n  const [stato, setStato] = useState<StatoGiardino | null>(null);\n  const [conn, setConn] = useState<'connecting' | 'connected' | 'error'>('connecting');\n  const clientRef = useRef<MqttClient | null>(null);\n\n  // Funzione per registrare la subscription push (placeholder, backend dopo)\n  async function registraPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        const sub = await reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n        // Invia la subscription al backend\n        await fetch('http://localhost:4000/subscribe', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(sub)\n        });\n        console.log('Push subscription inviata al backend:', JSON.stringify(sub));\n      } catch (e) {\n        console.warn('Push subscription error', e);\n      }\n    }\n  }\n\n  // Funzione di utilità per VAPID key\n  function urlBase64ToUint8Array(base64String: string) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n\n  // Recupera la famiglia selezionata da localStorage all'avvio\n  useEffect(() => {\n    const salvata = localStorage.getItem('famiglia');\n    if (salvata) {\n      setFamigliaSelezionata(salvata);\n      setFamiglia(salvata);\n    }\n  }, []);\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_BROKER);\n    clientRef.current = client;\n\n    client.on('connect', () => {\n      setConn('connected');\n      client.subscribe(TOPIC);\n    });\n    client.on('error', () => {\n      setConn('connecting'); // Riprova sempre\n    });\n    client.on('message', (topic, msg) => {\n      if (topic === TOPIC) {\n        try {\n          const data = JSON.parse(msg.toString());\n          if (data.stato && data.famiglia && data.timestamp) {\n            setStato(data);\n          }\n        } catch {}\n      }\n    });\n    return () => { client.end(); };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const pubblicaStato = (nuovoStato: 'libero' | 'occupato') => {\n    if (clientRef.current && clientRef.current.connected && famigliaSelezionata) {\n      const payload: StatoGiardino = {\n        stato: nuovoStato,\n        famiglia: famigliaSelezionata,\n        timestamp: Date.now(),\n      };\n      clientRef.current.publish(TOPIC, JSON.stringify(payload));\n      // Aggiornamento ottimistico locale\n      setStato(payload);\n    }\n  };\n\n  let boxClass = 'giardino-card';\n  let boxText = 'Giardino libero';\n  let infoText = '';\n  if (stato) {\n    if (stato.stato === 'occupato') {\n      boxClass += ' occupato';\n      boxText = 'Giardino occupato';\n      infoText = `Occupato da: ${stato.famiglia} dal ${formatDate(stato.timestamp)}`;\n    } else {\n      boxText = 'Giardino libero';\n      infoText = `Ultimo utilizzatore: ${stato.famiglia} (liberato il ${formatDate(stato.timestamp)})`;\n    }\n  }\n\n  if (conn !== 'connected') {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 32,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Connessione al broker MQTT...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di selezione famiglia\n  if (!famigliaSelezionata) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            <div style={{ marginBottom: 32 }}>Seleziona la tua famiglia:</div>\n            <select\n              value={famiglia}\n              onChange={e => setFamiglia(e.target.value)}\n              style={{ fontSize: 22, marginBottom: 24 }}\n            >\n              <option value=\"\" disabled>-- Scegli --</option>\n              {FAMIGLIE.map(f => <option key={f} value={f}>{f}</option>)}\n            </select>\n            <button\n              style={{ fontSize: 20, padding: '10px 24px' }}\n              disabled={!famiglia}\n              onClick={async () => {\n                setFamigliaSelezionata(famiglia);\n                localStorage.setItem('famiglia', famiglia);\n                const perm = await richiediPermessoNotifiche();\n                if (perm === 'granted') {\n                  await registraPush();\n                }\n              }}\n            >\n              Conferma\n            </button>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h2>Gestione Giardino</h2>\n        <div style={{ marginBottom: 24, fontSize: 18, color: '#fff' }}>\n          Famiglia selezionata: <b>{famigliaSelezionata}</b>\n        </div>\n        <div style={{ display: 'flex', gap: 16, marginBottom: 32 }}>\n          <button\n            style={{ fontSize: 18, padding: '10px 24px' }}\n            onClick={() => pubblicaStato('occupato')}\n            disabled={\n              (stato?.stato === 'occupato' && stato?.famiglia === famigliaSelezionata) ||\n              (stato?.stato === 'occupato' && stato?.famiglia !== famigliaSelezionata)\n            }\n          >\n            Occupa giardino\n          </button>\n          <button\n            style={{ fontSize: 18, padding: '10px 24px' }}\n            onClick={() => pubblicaStato('libero')}\n            disabled={\n              !(stato?.stato === 'occupato' && stato?.famiglia === famigliaSelezionata)\n            }\n          >\n            Libera giardino\n          </button>\n        </div>\n        <div className={boxClass}>\n          {boxText}\n          <div className=\"giardino-info\">{infoText}</div>\n        </div>\n        <div style={{ marginTop: 32, fontSize: 16, color: '#aaa' }}>\n          Stato MQTT: {conn === 'connected' ? 'Connesso' : conn === 'connecting' ? 'Connessione...' : 'Errore'}\n        </div>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}