{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import mqtt from'mqtt';import'./App.css';import{richiediPermessoNotifiche}from'./index';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MQTT_BROKER='wss://test.mosquitto.org:8081';const TOPIC='giardino/stato';const FAMIGLIE=['Rossi','Bianchi'];const PUSH_SERVER_URL='https://cani-backend.onrender.com';function formatDate(ts){const d=new Date(ts);return d.toLocaleString();}function App(){const[famiglia,setFamiglia]=useState('');const[famigliaSelezionata,setFamigliaSelezionata]=useState(null);const[stato,setStato]=useState(null);const[conn,setConn]=useState('connecting');const clientRef=useRef(null);// Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\nasync function registraPush(){if('serviceWorker'in navigator&&'PushManager'in window){const reg=await navigator.serviceWorker.ready;try{// Recupera la VAPID public key dal backend\nconst resp=await fetch(PUSH_SERVER_URL+'/vapidPublicKey');const data=await resp.json();const VAPID_PUBLIC_KEY=data.publicKey;const sub=await reg.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:urlBase64ToUint8Array(VAPID_PUBLIC_KEY)});// Invia la subscription al backend\nawait fetch(PUSH_SERVER_URL+'/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(sub)});console.log('Push subscription inviata al backend:',JSON.stringify(sub));}catch(e){console.warn('Push subscription error',e);}}}// Funzione di utilità per VAPID key\nfunction urlBase64ToUint8Array(base64String){const padding='='.repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/-/g,'+').replace(/_/g,'/');const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i);}return outputArray;}// Recupera la famiglia selezionata da localStorage all'avvio\nuseEffect(()=>{const salvata=localStorage.getItem('famiglia');if(salvata){setFamigliaSelezionata(salvata);setFamiglia(salvata);}},[]);useEffect(()=>{const client=mqtt.connect(MQTT_BROKER);clientRef.current=client;client.on('connect',()=>{setConn('connected');client.subscribe(TOPIC);});client.on('error',()=>{setConn('connecting');// Riprova sempre\n});client.on('message',(topic,msg)=>{if(topic===TOPIC){try{const data=JSON.parse(msg.toString());if(data.stato&&data.famiglia&&data.timestamp){setStato(data);}}catch{}}});return()=>{client.end();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const pubblicaStato=nuovoStato=>{if(clientRef.current&&clientRef.current.connected&&famigliaSelezionata){const payload={stato:nuovoStato,famiglia:famigliaSelezionata,timestamp:Date.now()};clientRef.current.publish(TOPIC,JSON.stringify(payload));// Aggiornamento ottimistico locale\nsetStato(payload);}};let boxClass='giardino-card';let boxText='Giardino libero';let infoText='';if(stato){if(stato.stato==='occupato'){boxClass+=' occupato';boxText='Giardino occupato';infoText=`Occupato da: ${stato.famiglia} dal ${formatDate(stato.timestamp)}`;}else{boxText='Giardino libero';infoText=`Ultimo utilizzatore: ${stato.famiglia} (liberato il ${formatDate(stato.timestamp)})`;}}if(conn!=='connected'){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:32,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Connessione al broker MQTT...\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24,fontSize:18,color:'#aaa'},children:\"Attendere...\"})]})})});}// Schermata di selezione famiglia\nif(!famigliaSelezionata){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:32},children:\"Seleziona la tua famiglia:\"}),/*#__PURE__*/_jsxs(\"select\",{value:famiglia,onChange:e=>setFamiglia(e.target.value),style:{fontSize:22,marginBottom:24},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"-- Scegli --\"}),FAMIGLIE.map(f=>/*#__PURE__*/_jsx(\"option\",{value:f,children:f},f))]}),/*#__PURE__*/_jsx(\"button\",{style:{fontSize:20,padding:'10px 24px'},disabled:!famiglia,onClick:async()=>{setFamigliaSelezionata(famiglia);localStorage.setItem('famiglia',famiglia);const perm=await richiediPermessoNotifiche();if(perm==='granted'){await registraPush();}},children:\"Conferma\"})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Gestione Giardino\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:24,fontSize:18,color:'#fff'},children:[\"Famiglia selezionata: \",/*#__PURE__*/_jsx(\"b\",{children:famigliaSelezionata})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:16,marginBottom:32},children:[/*#__PURE__*/_jsx(\"button\",{style:{fontSize:18,padding:'10px 24px'},onClick:()=>pubblicaStato('occupato'),disabled:(stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&(stato===null||stato===void 0?void 0:stato.famiglia)===famigliaSelezionata||(stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&(stato===null||stato===void 0?void 0:stato.famiglia)!==famigliaSelezionata,children:\"Occupa giardino\"}),/*#__PURE__*/_jsx(\"button\",{style:{fontSize:18,padding:'10px 24px'},onClick:()=>pubblicaStato('libero'),disabled:!((stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&(stato===null||stato===void 0?void 0:stato.famiglia)===famigliaSelezionata),children:\"Libera giardino\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:boxClass,children:[boxText,/*#__PURE__*/_jsx(\"div\",{className:\"giardino-info\",children:infoText})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:32,fontSize:16,color:'#aaa'},children:[\"Stato MQTT: \",conn==='connected'?'Connesso':conn==='connecting'?'Connessione...':'Errore']})]})});}export default App;","map":{"version":3,"names":["React","useEffect","useRef","useState","mqtt","richiediPermessoNotifiche","jsx","_jsx","jsxs","_jsxs","MQTT_BROKER","TOPIC","FAMIGLIE","PUSH_SERVER_URL","formatDate","ts","d","Date","toLocaleString","App","famiglia","setFamiglia","famigliaSelezionata","setFamigliaSelezionata","stato","setStato","conn","setConn","clientRef","registraPush","navigator","window","reg","serviceWorker","ready","resp","fetch","data","json","VAPID_PUBLIC_KEY","publicKey","sub","pushManager","subscribe","userVisibleOnly","applicationServerKey","urlBase64ToUint8Array","method","headers","body","JSON","stringify","console","log","e","warn","base64String","padding","repeat","length","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","salvata","localStorage","getItem","client","connect","current","on","topic","msg","parse","toString","timestamp","end","pubblicaStato","nuovoStato","connected","payload","now","publish","boxClass","boxText","infoText","className","children","style","background","color","borderRadius","width","height","display","flexDirection","alignItems","justifyContent","fontSize","fontWeight","margin","boxShadow","position","marginTop","marginBottom","value","onChange","target","disabled","map","f","onClick","setItem","perm","gap"],"sources":["/home/ares-desktop/localRepo/cani/mqtt-react-demo/src/App.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport mqtt, { MqttClient } from 'mqtt';\nimport './App.css';\nimport { richiediPermessoNotifiche } from './index';\n\nconst MQTT_BROKER = 'wss://test.mosquitto.org:8081';\nconst TOPIC = 'giardino/stato';\nconst FAMIGLIE = ['Rossi', 'Bianchi'];\nconst PUSH_SERVER_URL = 'https://cani-backend.onrender.com';\n\ntype StatoGiardino = {\n  stato: 'libero' | 'occupato';\n  famiglia: string;\n  timestamp: number;\n};\n\nfunction formatDate(ts: number) {\n  const d = new Date(ts);\n  return d.toLocaleString();\n}\n\nfunction App() {\n  const [famiglia, setFamiglia] = useState<string>('');\n  const [famigliaSelezionata, setFamigliaSelezionata] = useState<string | null>(null);\n  const [stato, setStato] = useState<StatoGiardino | null>(null);\n  const [conn, setConn] = useState<'connecting' | 'connected' | 'error'>('connecting');\n  const clientRef = useRef<MqttClient | null>(null);\n\n  // Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\n  async function registraPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        // Recupera la VAPID public key dal backend\n        const resp = await fetch(PUSH_SERVER_URL + '/vapidPublicKey');\n        const data = await resp.json();\n        const VAPID_PUBLIC_KEY = data.publicKey;\n        const sub = await reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n        // Invia la subscription al backend\n        await fetch(PUSH_SERVER_URL + '/subscribe', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(sub)\n        });\n        console.log('Push subscription inviata al backend:', JSON.stringify(sub));\n      } catch (e) {\n        console.warn('Push subscription error', e);\n      }\n    }\n  }\n\n  // Funzione di utilità per VAPID key\n  function urlBase64ToUint8Array(base64String: string) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n\n  // Recupera la famiglia selezionata da localStorage all'avvio\n  useEffect(() => {\n    const salvata = localStorage.getItem('famiglia');\n    if (salvata) {\n      setFamigliaSelezionata(salvata);\n      setFamiglia(salvata);\n    }\n  }, []);\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_BROKER);\n    clientRef.current = client;\n\n    client.on('connect', () => {\n      setConn('connected');\n      client.subscribe(TOPIC);\n    });\n    client.on('error', () => {\n      setConn('connecting'); // Riprova sempre\n    });\n    client.on('message', (topic, msg) => {\n      if (topic === TOPIC) {\n        try {\n          const data = JSON.parse(msg.toString());\n          if (data.stato && data.famiglia && data.timestamp) {\n            setStato(data);\n          }\n        } catch {}\n      }\n    });\n    return () => { client.end(); };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const pubblicaStato = (nuovoStato: 'libero' | 'occupato') => {\n    if (clientRef.current && clientRef.current.connected && famigliaSelezionata) {\n      const payload: StatoGiardino = {\n        stato: nuovoStato,\n        famiglia: famigliaSelezionata,\n        timestamp: Date.now(),\n      };\n      clientRef.current.publish(TOPIC, JSON.stringify(payload));\n      // Aggiornamento ottimistico locale\n      setStato(payload);\n    }\n  };\n\n  let boxClass = 'giardino-card';\n  let boxText = 'Giardino libero';\n  let infoText = '';\n  if (stato) {\n    if (stato.stato === 'occupato') {\n      boxClass += ' occupato';\n      boxText = 'Giardino occupato';\n      infoText = `Occupato da: ${stato.famiglia} dal ${formatDate(stato.timestamp)}`;\n    } else {\n      boxText = 'Giardino libero';\n      infoText = `Ultimo utilizzatore: ${stato.famiglia} (liberato il ${formatDate(stato.timestamp)})`;\n    }\n  }\n\n  if (conn !== 'connected') {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 32,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Connessione al broker MQTT...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di selezione famiglia\n  if (!famigliaSelezionata) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            <div style={{ marginBottom: 32 }}>Seleziona la tua famiglia:</div>\n            <select\n              value={famiglia}\n              onChange={e => setFamiglia(e.target.value)}\n              style={{ fontSize: 22, marginBottom: 24 }}\n            >\n              <option value=\"\" disabled>-- Scegli --</option>\n              {FAMIGLIE.map(f => <option key={f} value={f}>{f}</option>)}\n            </select>\n            <button\n              style={{ fontSize: 20, padding: '10px 24px' }}\n              disabled={!famiglia}\n              onClick={async () => {\n                setFamigliaSelezionata(famiglia);\n                localStorage.setItem('famiglia', famiglia);\n                const perm = await richiediPermessoNotifiche();\n                if (perm === 'granted') {\n                  await registraPush();\n                }\n              }}\n            >\n              Conferma\n            </button>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h2>Gestione Giardino</h2>\n        <div style={{ marginBottom: 24, fontSize: 18, color: '#fff' }}>\n          Famiglia selezionata: <b>{famigliaSelezionata}</b>\n        </div>\n        <div style={{ display: 'flex', gap: 16, marginBottom: 32 }}>\n          <button\n            style={{ fontSize: 18, padding: '10px 24px' }}\n            onClick={() => pubblicaStato('occupato')}\n            disabled={\n              (stato?.stato === 'occupato' && stato?.famiglia === famigliaSelezionata) ||\n              (stato?.stato === 'occupato' && stato?.famiglia !== famigliaSelezionata)\n            }\n          >\n            Occupa giardino\n          </button>\n          <button\n            style={{ fontSize: 18, padding: '10px 24px' }}\n            onClick={() => pubblicaStato('libero')}\n            disabled={\n              !(stato?.stato === 'occupato' && stato?.famiglia === famigliaSelezionata)\n            }\n          >\n            Libera giardino\n          </button>\n        </div>\n        <div className={boxClass}>\n          {boxText}\n          <div className=\"giardino-info\">{infoText}</div>\n        </div>\n        <div style={{ marginTop: 32, fontSize: 16, color: '#aaa' }}>\n          Stato MQTT: {conn === 'connected' ? 'Connesso' : conn === 'connecting' ? 'Connessione...' : 'Errore'}\n        </div>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}