{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import mqtt from'mqtt';import'./App.css';import{richiediPermessoNotifiche}from'./index';// Importo le icone da react-icons\nimport{FaLock,FaLeaf,FaCheck}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MQTT_BROKER='wss://test.mosquitto.org:8081';const TOPIC='giardino/stato';const FAMIGLIE=['ermes-ben','raya','Visualizzatore'];const PUSH_SERVER_URL='https://cani-backend.onrender.com';function formatDate(ts){const d=new Date(ts);return d.toLocaleString();}function App(){const[famiglia,setFamiglia]=useState('');const[famigliaSelezionata,setFamigliaSelezionata]=useState(null);const[stato,setStato]=useState(null);const[conn,setConn]=useState('connecting');const[notificheAttive,setNotificheAttive]=useState(false);const clientRef=useRef(null);// Stato per mostrare il pulsante di sblocco dopo 20s\nconst[showUnlock,setShowUnlock]=React.useState(false);// Stato per attesa backend\nconst[backendReady,setBackendReady]=React.useState(false);// Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\nasync function registraPush(){if('serviceWorker'in navigator&&'PushManager'in window){const reg=await navigator.serviceWorker.ready;try{// Recupera la VAPID public key dal backend\nconst resp=await fetch(PUSH_SERVER_URL+'/vapidPublicKey');const data=await resp.json();const VAPID_PUBLIC_KEY=data.publicKey;const sub=await reg.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:urlBase64ToUint8Array(VAPID_PUBLIC_KEY)});// Invia la subscription al backend\nawait fetch(PUSH_SERVER_URL+'/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(sub)});console.log('Push subscription inviata al backend:',JSON.stringify(sub));return true;}catch(e){console.warn('Push subscription error',e);return false;}}return false;}// Funzione per cancellare la subscription push\nasync function cancellaPush(){if('serviceWorker'in navigator&&'PushManager'in window){const reg=await navigator.serviceWorker.ready;try{const subscription=await reg.pushManager.getSubscription();if(subscription){// Notifica il backend della cancellazione\ntry{await fetch(PUSH_SERVER_URL+'/unsubscribe',{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({endpoint:subscription.endpoint})});}catch(e){console.warn('Errore notifica cancellazione al backend:',e);}await subscription.unsubscribe();console.log('Push subscription cancellata');return true;}}catch(e){console.warn('Push unsubscription error',e);}}return false;}// Funzione per gestire l'attivazione/disattivazione delle notifiche\nasync function toggleNotifiche(){if(!notificheAttive){// Attiva notifiche\nconst perm=await richiediPermessoNotifiche();if(perm==='granted'){const success=await registraPush();if(success){setNotificheAttive(true);localStorage.setItem('notificheAttive','true');}}}else{// Disattiva notifiche\nconst success=await cancellaPush();if(success){setNotificheAttive(false);localStorage.setItem('notificheAttive','false');}}}// Funzione di utilità per VAPID key\nfunction urlBase64ToUint8Array(base64String){const padding='='.repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/-/g,'+').replace(/_/g,'/');const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i);}return outputArray;}// Recupera la famiglia selezionata e lo stato notifiche da localStorage all'avvio\nuseEffect(()=>{const salvata=localStorage.getItem('famiglia');const notificheSalvate=localStorage.getItem('notificheAttive');if(salvata){setFamigliaSelezionata(salvata);setFamiglia(salvata);}if(notificheSalvate){setNotificheAttive(notificheSalvate==='true');}},[]);// Controllo backend all'avvio\nReact.useEffect(()=>{let stop=false;async function checkBackend(){try{const resp=await fetch(PUSH_SERVER_URL+'/health',{method:'GET'});if(resp.ok){setBackendReady(true);return;}}catch{}if(!stop)setTimeout(checkBackend,3000);}checkBackend();return()=>{stop=true;};},[]);// Ping periodico per tenere sveglio il backend (ogni 5 minuti)\nReact.useEffect(()=>{const interval=setInterval(()=>{fetch(PUSH_SERVER_URL+'/health').catch(()=>{});},5*60*1000);// ogni 5 minuti\nreturn()=>clearInterval(interval);},[]);useEffect(()=>{const client=mqtt.connect(MQTT_BROKER);clientRef.current=client;client.on('connect',()=>{setConn('connected');client.subscribe(TOPIC);});client.on('error',()=>{setConn('connecting');// Riprova sempre\n});client.on('message',(topic,msg)=>{if(topic===TOPIC){try{const data=JSON.parse(msg.toString());if(data.stato&&data.famiglia&&data.timestamp){setStato(data);}}catch{}}});return()=>{client.end();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(conn==='connected'&&stato===null){const t=setTimeout(()=>setShowUnlock(true),20000);return()=>clearTimeout(t);}else{setShowUnlock(false);}},[conn,stato]);const pubblicaStato=nuovoStato=>{if(clientRef.current&&clientRef.current.connected&&famigliaSelezionata){const payload={stato:nuovoStato,famiglia:famigliaSelezionata,timestamp:Date.now()};clientRef.current.publish(TOPIC,JSON.stringify(payload),{retain:true});// Aggiornamento ottimistico locale\nsetStato(payload);}};// Card stato giardino\nlet cardClass='giardino-card';let cardGradient=stato&&stato.stato==='occupato'?'giardino-card-occupato':'giardino-card-libero';let cardIcon=stato&&stato.stato==='occupato'?/*#__PURE__*/_jsx(FaLock,{size:48,style:{marginBottom:12}}):/*#__PURE__*/_jsx(FaLeaf,{size:48,style:{marginBottom:12}});let cardTitle=stato&&stato.stato==='occupato'?'Giardino occupato':'Giardino libero';let cardInfo=stato?stato.stato==='occupato'?`Occupato da: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`:`Ultimo utilizzatore: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`:'';// Blocca tutto finché il backend non è up\nif(!backendReady){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Avvio backend...\",/*#__PURE__*/_jsx(\"br\",{}),\"Potrebbe volerci qualche momento\"]})})});}if(conn!=='connected'){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:32,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Connessione al broker MQTT...\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24,fontSize:18,color:'#aaa'},children:\"Attendere...\"})]})})});}// Schermata di caricamento stato giardino\nif(conn==='connected'&&stato===null){// Funzione per pubblicare uno stato iniziale retained\nconst pubblicaStatoIniziale=()=>{if(clientRef.current&&clientRef.current.connected){const payload={stato:'libero',famiglia:'iniziale',timestamp:Date.now()};clientRef.current.publish(TOPIC,JSON.stringify(payload),{retain:true});}};return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:260,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Recupero stato giardino...\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24,fontSize:18,color:'#aaa'},children:\"Attendere...\"}),showUnlock&&/*#__PURE__*/_jsx(\"button\",{style:{marginTop:32,fontSize:18},onClick:pubblicaStatoIniziale,children:\"Sblocca (pubblica stato iniziale)\"})]})})});}// Schermata di selezione famiglia\nif(!famigliaSelezionata){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:32},children:\"Seleziona la tua famiglia:\"}),/*#__PURE__*/_jsxs(\"select\",{value:famiglia,onChange:e=>setFamiglia(e.target.value),style:{fontSize:22,marginBottom:24},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"-- Scegli --\"}),FAMIGLIE.map(f=>/*#__PURE__*/_jsx(\"option\",{value:f,children:f==='Visualizzatore'?'Visualizzatore (solo lettura)':f},f))]}),/*#__PURE__*/_jsx(\"button\",{style:{fontSize:20,padding:'10px 24px'},disabled:!famiglia,onClick:async()=>{setFamigliaSelezionata(famiglia);localStorage.setItem('famiglia',famiglia);},children:\"Conferma\"})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"famiglia-label\",children:[\"Famiglia selezionata:\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"famiglia-nome\",children:famigliaSelezionata})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"notifiche-card\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Notifiche Push\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"notifiche-switch\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"switch\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:notificheAttive,onChange:toggleNotifiche}),/*#__PURE__*/_jsx(\"span\",{className:\"slider round\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"notifiche-stato\",children:notificheAttive?'Attive':'Spente'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:`${cardClass} ${cardGradient}`,children:[cardIcon,/*#__PURE__*/_jsx(\"div\",{className:\"giardino-title\",children:cardTitle}),/*#__PURE__*/_jsx(\"div\",{className:\"giardino-info\",children:cardInfo})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bottoni-row\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"giardino-btn occupa\",onClick:()=>pubblicaStato('occupato'),disabled:(stato===null||stato===void 0?void 0:stato.stato)==='occupato'||famigliaSelezionata==='Visualizzatore',children:[/*#__PURE__*/_jsx(FaLeaf,{style:{marginRight:8}}),\"Occupa Giardino\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"giardino-btn libera\",onClick:()=>pubblicaStato('libero'),disabled:(stato===null||stato===void 0?void 0:stato.stato)!=='occupato'||(stato===null||stato===void 0?void 0:stato.famiglia)!==famigliaSelezionata,children:[/*#__PURE__*/_jsx(FaCheck,{style:{marginRight:8}}),\"Libera Giardino\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mqtt-label\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mqtt-dot\"}),\" MQTT: Connesso\"]})]})});}export default App;","map":{"version":3,"names":["React","useEffect","useRef","useState","mqtt","richiediPermessoNotifiche","FaLock","FaLeaf","FaCheck","jsx","_jsx","jsxs","_jsxs","MQTT_BROKER","TOPIC","FAMIGLIE","PUSH_SERVER_URL","formatDate","ts","d","Date","toLocaleString","App","famiglia","setFamiglia","famigliaSelezionata","setFamigliaSelezionata","stato","setStato","conn","setConn","notificheAttive","setNotificheAttive","clientRef","showUnlock","setShowUnlock","backendReady","setBackendReady","registraPush","navigator","window","reg","serviceWorker","ready","resp","fetch","data","json","VAPID_PUBLIC_KEY","publicKey","sub","pushManager","subscribe","userVisibleOnly","applicationServerKey","urlBase64ToUint8Array","method","headers","body","JSON","stringify","console","log","e","warn","cancellaPush","subscription","getSubscription","endpoint","unsubscribe","toggleNotifiche","perm","success","localStorage","setItem","base64String","padding","repeat","length","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","salvata","getItem","notificheSalvate","stop","checkBackend","ok","setTimeout","interval","setInterval","catch","clearInterval","client","connect","current","on","topic","msg","parse","toString","timestamp","end","t","clearTimeout","pubblicaStato","nuovoStato","connected","payload","now","publish","retain","cardClass","cardGradient","cardIcon","size","style","marginBottom","cardTitle","cardInfo","className","children","background","color","borderRadius","width","height","display","flexDirection","alignItems","justifyContent","fontSize","fontWeight","margin","boxShadow","position","marginTop","pubblicaStatoIniziale","onClick","value","onChange","target","disabled","map","f","type","checked","marginRight"],"sources":["/home/ares-desktop/localRepo/cani/mqtt-react-demo/src/App.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport mqtt, { MqttClient } from 'mqtt';\nimport './App.css';\nimport { richiediPermessoNotifiche } from './index';\n// Importo le icone da react-icons\nimport { FaLock, FaLeaf, FaCheck } from 'react-icons/fa';\n\nconst MQTT_BROKER = 'wss://test.mosquitto.org:8081';\nconst TOPIC = 'giardino/stato';\nconst FAMIGLIE = ['ermes-ben', 'raya', 'Visualizzatore'];\nconst PUSH_SERVER_URL = 'https://cani-backend.onrender.com';\n\ntype StatoGiardino = {\n  stato: 'libero' | 'occupato';\n  famiglia: string;\n  timestamp: number;\n};\n\nfunction formatDate(ts: number) {\n  const d = new Date(ts);\n  return d.toLocaleString();\n}\n\nfunction App() {\n  const [famiglia, setFamiglia] = useState<string>('');\n  const [famigliaSelezionata, setFamigliaSelezionata] = useState<string | null>(null);\n  const [stato, setStato] = useState<StatoGiardino | null>(null);\n  const [conn, setConn] = useState<'connecting' | 'connected' | 'error'>('connecting');\n  const [notificheAttive, setNotificheAttive] = useState<boolean>(false);\n  const clientRef = useRef<MqttClient | null>(null);\n  // Stato per mostrare il pulsante di sblocco dopo 20s\n  const [showUnlock, setShowUnlock] = React.useState(false);\n  // Stato per attesa backend\n  const [backendReady, setBackendReady] = React.useState<boolean>(false);\n\n  // Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\n  async function registraPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        // Recupera la VAPID public key dal backend\n        const resp = await fetch(PUSH_SERVER_URL + '/vapidPublicKey');\n        const data = await resp.json();\n        const VAPID_PUBLIC_KEY = data.publicKey;\n        const sub = await reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n        // Invia la subscription al backend\n        await fetch(PUSH_SERVER_URL + '/subscribe', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(sub)\n        });\n        console.log('Push subscription inviata al backend:', JSON.stringify(sub));\n        return true;\n      } catch (e) {\n        console.warn('Push subscription error', e);\n        return false;\n      }\n    }\n    return false;\n  }\n\n  // Funzione per cancellare la subscription push\n  async function cancellaPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        const subscription = await reg.pushManager.getSubscription();\n        if (subscription) {\n          // Notifica il backend della cancellazione\n          try {\n            await fetch(PUSH_SERVER_URL + '/unsubscribe', {\n              method: 'DELETE',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ endpoint: subscription.endpoint })\n            });\n          } catch (e) {\n            console.warn('Errore notifica cancellazione al backend:', e);\n          }\n          \n          await subscription.unsubscribe();\n          console.log('Push subscription cancellata');\n          return true;\n        }\n      } catch (e) {\n        console.warn('Push unsubscription error', e);\n      }\n    }\n    return false;\n  }\n\n  // Funzione per gestire l'attivazione/disattivazione delle notifiche\n  async function toggleNotifiche() {\n    if (!notificheAttive) {\n      // Attiva notifiche\n      const perm = await richiediPermessoNotifiche();\n      if (perm === 'granted') {\n        const success = await registraPush();\n        if (success) {\n          setNotificheAttive(true);\n          localStorage.setItem('notificheAttive', 'true');\n        }\n      }\n    } else {\n      // Disattiva notifiche\n      const success = await cancellaPush();\n      if (success) {\n        setNotificheAttive(false);\n        localStorage.setItem('notificheAttive', 'false');\n      }\n    }\n  }\n\n  // Funzione di utilità per VAPID key\n  function urlBase64ToUint8Array(base64String: string) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n\n  // Recupera la famiglia selezionata e lo stato notifiche da localStorage all'avvio\n  useEffect(() => {\n    const salvata = localStorage.getItem('famiglia');\n    const notificheSalvate = localStorage.getItem('notificheAttive');\n    if (salvata) {\n      setFamigliaSelezionata(salvata);\n      setFamiglia(salvata);\n    }\n    if (notificheSalvate) {\n      setNotificheAttive(notificheSalvate === 'true');\n    }\n  }, []);\n\n  // Controllo backend all'avvio\n  React.useEffect(() => {\n    let stop = false;\n    async function checkBackend() {\n      try {\n        const resp = await fetch(PUSH_SERVER_URL + '/health', { method: 'GET' });\n        if (resp.ok) {\n          setBackendReady(true);\n          return;\n        }\n      } catch {}\n      if (!stop) setTimeout(checkBackend, 3000);\n    }\n    checkBackend();\n    return () => { stop = true; };\n  }, []);\n\n  // Ping periodico per tenere sveglio il backend (ogni 5 minuti)\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      fetch(PUSH_SERVER_URL + '/health').catch(() => {});\n    }, 5 * 60 * 1000); // ogni 5 minuti\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_BROKER);\n    clientRef.current = client;\n\n    client.on('connect', () => {\n      setConn('connected');\n      client.subscribe(TOPIC);\n    });\n    client.on('error', () => {\n      setConn('connecting'); // Riprova sempre\n    });\n    client.on('message', (topic, msg) => {\n      if (topic === TOPIC) {\n        try {\n          const data = JSON.parse(msg.toString());\n          if (data.stato && data.famiglia && data.timestamp) {\n            setStato(data);\n          }\n        } catch {}\n      }\n    });\n    return () => { client.end(); };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (conn === 'connected' && stato === null) {\n      const t = setTimeout(() => setShowUnlock(true), 20000);\n      return () => clearTimeout(t);\n    } else {\n      setShowUnlock(false);\n    }\n  }, [conn, stato]);\n\n  const pubblicaStato = (nuovoStato: 'libero' | 'occupato') => {\n    if (clientRef.current && clientRef.current.connected && famigliaSelezionata) {\n      const payload: StatoGiardino = {\n        stato: nuovoStato,\n        famiglia: famigliaSelezionata,\n        timestamp: Date.now(),\n      };\n      clientRef.current.publish(TOPIC, JSON.stringify(payload), { retain: true });\n      // Aggiornamento ottimistico locale\n      setStato(payload);\n    }\n  };\n\n  // Card stato giardino\n  let cardClass = 'giardino-card';\n  let cardGradient = stato && stato.stato === 'occupato'\n    ? 'giardino-card-occupato'\n    : 'giardino-card-libero';\n  let cardIcon = stato && stato.stato === 'occupato' ? <FaLock size={48} style={{marginBottom: 12}} /> : <FaLeaf size={48} style={{marginBottom: 12}} />;\n  let cardTitle = stato && stato.stato === 'occupato' ? 'Giardino occupato' : 'Giardino libero';\n  let cardInfo = stato\n    ? (stato.stato === 'occupato'\n        ? `Occupato da: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`\n        : `Ultimo utilizzatore: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`)\n    : '';\n\n  // Blocca tutto finché il backend non è up\n  if (!backendReady) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Avvio backend...<br />Potrebbe volerci qualche momento\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  if (conn !== 'connected') {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 32,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Connessione al broker MQTT...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di caricamento stato giardino\n  if (conn === 'connected' && stato === null) {\n    // Funzione per pubblicare uno stato iniziale retained\n    const pubblicaStatoIniziale = () => {\n      if (clientRef.current && clientRef.current.connected) {\n        const payload = {\n          stato: 'libero',\n          famiglia: 'iniziale',\n          timestamp: Date.now(),\n        };\n        clientRef.current.publish(TOPIC, JSON.stringify(payload), { retain: true });\n      }\n    };\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 260,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Recupero stato giardino...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n            {showUnlock && (\n              <button style={{ marginTop: 32, fontSize: 18 }} onClick={pubblicaStatoIniziale}>\n                Sblocca (pubblica stato iniziale)\n              </button>\n            )}\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di selezione famiglia\n  if (!famigliaSelezionata) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            <div style={{ marginBottom: 32 }}>Seleziona la tua famiglia:</div>\n            <select\n              value={famiglia}\n              onChange={e => setFamiglia(e.target.value)}\n              style={{ fontSize: 22, marginBottom: 24 }}\n            >\n              <option value=\"\" disabled>-- Scegli --</option>\n              {FAMIGLIE.map(f => (\n                <option key={f} value={f}>\n                  {f === 'Visualizzatore' ? 'Visualizzatore (solo lettura)' : f}\n                </option>\n              ))}\n            </select>\n            <button\n              style={{ fontSize: 20, padding: '10px 24px' }}\n              disabled={!famiglia}\n              onClick={async () => {\n                setFamigliaSelezionata(famiglia);\n                localStorage.setItem('famiglia', famiglia);\n              }}\n            >\n              Conferma\n            </button>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <div className=\"famiglia-label\">\n          Famiglia selezionata:<br />\n          <span className=\"famiglia-nome\">{famigliaSelezionata}</span>\n        </div>\n        <div className=\"notifiche-card\">\n          <span>Notifiche Push</span>\n          <div className=\"notifiche-switch\">\n            <label className=\"switch\">\n              <input\n                type=\"checkbox\"\n                checked={notificheAttive}\n                onChange={toggleNotifiche}\n              />\n              <span className=\"slider round\"></span>\n            </label>\n            <span className=\"notifiche-stato\">{notificheAttive ? 'Attive' : 'Spente'}</span>\n          </div>\n        </div>\n        <div className={`${cardClass} ${cardGradient}`}> \n          {cardIcon}\n          <div className=\"giardino-title\">{cardTitle}</div>\n          <div className=\"giardino-info\">{cardInfo}</div>\n        </div>\n        <div className=\"bottoni-row\">\n          <button\n            className=\"giardino-btn occupa\"\n            onClick={() => pubblicaStato('occupato')}\n            disabled={stato?.stato === 'occupato' || famigliaSelezionata === 'Visualizzatore'}\n          >\n            <FaLeaf style={{marginRight: 8}} />Occupa Giardino\n          </button>\n          <button\n            className=\"giardino-btn libera\"\n            onClick={() => pubblicaStato('libero')}\n            disabled={stato?.stato !== 'occupato' || stato?.famiglia !== famigliaSelezionata}\n          >\n            <FaCheck style={{marginRight: 8}} />Libera Giardino\n          </button>\n        </div>\n        <div className=\"mqtt-label\">\n          <span className=\"mqtt-dot\" /> MQTT: Connesso\n        </div>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}