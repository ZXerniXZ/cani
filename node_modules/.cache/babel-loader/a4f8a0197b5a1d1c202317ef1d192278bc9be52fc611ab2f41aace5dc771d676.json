{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import mqtt from'mqtt';import'./App.css';import{richiediPermessoNotifiche}from'./index';// Importo le icone da react-icons\nimport{FaLock,FaLeaf,FaCheck}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MQTT_BROKER='wss://test.mosquitto.org:8081';const TOPIC='giardino/stato';const FAMIGLIE=['ermes-ben','raya','Visualizzatore'];const PUSH_SERVER_URL='https://cani-backend.onrender.com';function formatDate(ts){const d=new Date(ts);return d.toLocaleString();}function App(){const[famiglia,setFamiglia]=useState('');const[famigliaSelezionata,setFamigliaSelezionata]=useState(null);const[stato,setStato]=useState(null);const[conn,setConn]=useState('connecting');const[notificheAttive,setNotificheAttive]=useState(false);const clientRef=useRef(null);// Stato per mostrare il pulsante di sblocco dopo 20s\nconst[showUnlock,setShowUnlock]=React.useState(false);// Stato per attesa backend\nconst[backendReady,setBackendReady]=React.useState(false);const[isBooking,setIsBooking]=React.useState(false);const[bookingConfirmed,setBookingConfirmed]=React.useState(false);const bookingTimeout=React.useRef(null);// Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\nasync function registraPush(){if('serviceWorker'in navigator&&'PushManager'in window){const reg=await navigator.serviceWorker.ready;try{// Recupera la VAPID public key dal backend\nconst resp=await fetch(PUSH_SERVER_URL+'/vapidPublicKey');const data=await resp.json();const VAPID_PUBLIC_KEY=data.publicKey;const sub=await reg.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:urlBase64ToUint8Array(VAPID_PUBLIC_KEY)});// Invia la subscription al backend\nawait fetch(PUSH_SERVER_URL+'/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(sub)});console.log('Push subscription inviata al backend:',JSON.stringify(sub));return true;}catch(e){console.warn('Push subscription error',e);return false;}}return false;}// Funzione per cancellare la subscription push\nasync function cancellaPush(){if('serviceWorker'in navigator&&'PushManager'in window){const reg=await navigator.serviceWorker.ready;try{const subscription=await reg.pushManager.getSubscription();if(subscription){// Notifica il backend della cancellazione\ntry{await fetch(PUSH_SERVER_URL+'/unsubscribe',{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({endpoint:subscription.endpoint})});}catch(e){console.warn('Errore notifica cancellazione al backend:',e);}await subscription.unsubscribe();console.log('Push subscription cancellata');return true;}}catch(e){console.warn('Push unsubscription error',e);}}return false;}// Funzione per gestire l'attivazione/disattivazione delle notifiche\nasync function toggleNotifiche(){if(!notificheAttive){// Attiva notifiche\nconst perm=await richiediPermessoNotifiche();if(perm==='granted'){const success=await registraPush();if(success){setNotificheAttive(true);localStorage.setItem('notificheAttive','true');}}}else{// Disattiva notifiche\nconst success=await cancellaPush();if(success){setNotificheAttive(false);localStorage.setItem('notificheAttive','false');}}}// Funzione di utilità per VAPID key\nfunction urlBase64ToUint8Array(base64String){const padding='='.repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/-/g,'+').replace(/_/g,'/');const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i);}return outputArray;}// Recupera la famiglia selezionata e lo stato notifiche da localStorage all'avvio\nuseEffect(()=>{const salvata=localStorage.getItem('famiglia');const notificheSalvate=localStorage.getItem('notificheAttive');if(salvata){setFamigliaSelezionata(salvata);setFamiglia(salvata);}if(notificheSalvate){setNotificheAttive(notificheSalvate==='true');}},[]);// Controllo backend all'avvio\nReact.useEffect(()=>{let stop=false;async function checkBackend(){try{const resp=await fetch(PUSH_SERVER_URL+'/health',{method:'GET'});if(resp.ok){setBackendReady(true);return;}}catch{}if(!stop)setTimeout(checkBackend,3000);}checkBackend();return()=>{stop=true;};},[]);// Ping periodico per tenere sveglio il backend (ogni 5 minuti)\nReact.useEffect(()=>{const interval=setInterval(()=>{fetch(PUSH_SERVER_URL+'/health').catch(()=>{});},5*60*1000);// ogni 5 minuti\nreturn()=>clearInterval(interval);},[]);useEffect(()=>{const client=mqtt.connect(MQTT_BROKER);clientRef.current=client;client.on('connect',()=>{setConn('connected');client.subscribe(TOPIC);});client.on('error',()=>{setConn('connecting');// Riprova sempre\n});client.on('message',(topic,msg)=>{if(topic===TOPIC){try{const data=JSON.parse(msg.toString());if(data.stato&&data.famiglia&&data.timestamp){setStato(data);}}catch{}}});return()=>{client.end();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(conn==='connected'&&stato===null){const t=setTimeout(()=>setShowUnlock(true),20000);return()=>clearTimeout(t);}else{setShowUnlock(false);}},[conn,stato]);const pubblicaStato=nuovoStato=>{if(clientRef.current&&clientRef.current.connected&&famigliaSelezionata){const payload={stato:nuovoStato,famiglia:famigliaSelezionata,timestamp:Date.now()};clientRef.current.publish(TOPIC,JSON.stringify(payload),{retain:true});// Aggiornamento ottimistico locale\nsetStato(payload);}};// Quando clicco Occupa Giardino\nconst handleOccupa=()=>{setIsBooking(true);setBookingConfirmed(false);pubblicaStato('occupato');// Se dopo 10s non arriva conferma, resetta\nif(bookingTimeout.current)clearTimeout(bookingTimeout.current);bookingTimeout.current=setTimeout(()=>setIsBooking(false),10000);};// Quando arriva il messaggio MQTT di occupazione confermata dalla propria famiglia\nReact.useEffect(()=>{if(isBooking&&(stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&stato.famiglia===famigliaSelezionata){setBookingConfirmed(true);setIsBooking(false);if(bookingTimeout.current)clearTimeout(bookingTimeout.current);}},[isBooking,stato,famigliaSelezionata]);// Card stato giardino\nlet cardClass='giardino-card';let cardGradient=stato&&stato.stato==='occupato'?'giardino-card-occupato':'giardino-card-libero';let cardIcon=stato&&stato.stato==='occupato'?/*#__PURE__*/_jsx(\"span\",{style:{display:'block',marginBottom:12},children:/*#__PURE__*/_jsx(FaLock,{size:48})}):/*#__PURE__*/_jsx(\"span\",{style:{display:'block',marginBottom:12},children:/*#__PURE__*/_jsx(FaLeaf,{size:48})});let cardTitle=stato&&stato.stato==='occupato'?'Giardino occupato':'Giardino libero';let cardInfo=stato?stato.stato==='occupato'?`Occupato da: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`:`Ultimo utilizzatore: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`:'';// Blocca tutto finché il backend non è up\nif(!backendReady){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Avvio backend...\",/*#__PURE__*/_jsx(\"br\",{}),\"Potrebbe volerci qualche momento\"]})})});}if(conn!=='connected'){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",style:{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",style:{width:'100vw',minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',padding:0},children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:32,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Connessione al broker MQTT...\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24,fontSize:18,color:'#aaa'},children:\"Attendere...\"})]})})});}// Schermata di caricamento stato giardino\nif(conn==='connected'&&stato===null){// Funzione per pubblicare uno stato iniziale retained\nconst pubblicaStatoIniziale=()=>{if(clientRef.current&&clientRef.current.connected){const payload={stato:'libero',famiglia:'iniziale',timestamp:Date.now()};clientRef.current.publish(TOPIC,JSON.stringify(payload),{retain:true});}};return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:260,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[\"Recupero stato giardino...\",/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24,fontSize:18,color:'#aaa'},children:\"Attendere...\"}),showUnlock&&/*#__PURE__*/_jsx(\"button\",{style:{marginTop:32,fontSize:18},onClick:pubblicaStatoIniziale,children:\"Sblocca (pubblica stato iniziale)\"})]})})});}// Schermata di selezione famiglia\nif(!famigliaSelezionata){return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"header\",{className:\"App-header\",children:/*#__PURE__*/_jsxs(\"div\",{style:{background:'#222',color:'#fff',borderRadius:16,width:400,height:220,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',fontSize:28,fontWeight:'bold',margin:'0 auto',boxShadow:'0 4px 24px #0006',position:'relative'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:32},children:\"Seleziona la tua famiglia:\"}),/*#__PURE__*/_jsxs(\"select\",{value:famiglia,onChange:e=>setFamiglia(e.target.value),style:{fontSize:22,marginBottom:24},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"-- Scegli --\"}),FAMIGLIE.map(f=>/*#__PURE__*/_jsx(\"option\",{value:f,children:f==='Visualizzatore'?'Visualizzatore (solo lettura)':f},f))]}),/*#__PURE__*/_jsx(\"button\",{style:{fontSize:20,padding:'10px 24px'},disabled:!famiglia,onClick:async()=>{setFamigliaSelezionata(famiglia);localStorage.setItem('famiglia',famiglia);},children:\"Conferma\"})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"famiglia-label\",children:[\"Famiglia selezionata:\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"famiglia-nome\",children:famigliaSelezionata})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"notifiche-card\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Notifiche Push\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"notifiche-switch\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"switch\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:notificheAttive,onChange:toggleNotifiche}),/*#__PURE__*/_jsx(\"span\",{className:\"slider round\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"notifiche-stato\",children:notificheAttive?'Attive':'Spente'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:`giardino-card ${cardGradient} ${isBooking||bookingConfirmed||(stato===null||stato===void 0?void 0:stato.stato)==='occupato'?'giardino-card-expanded':''} ${isBooking||bookingConfirmed?'giardino-card-booking':''} ${isBooking?'giardino-card-loading':''} ${bookingConfirmed?'giardino-card-success':''}`,children:isBooking?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"giardino-loader\"}),/*#__PURE__*/_jsx(\"div\",{className:\"giardino-info\",style:{marginTop:18,fontWeight:500,color:'#fff'},children:\"La tua richiesta sta venendo elaborata...\"})]}):bookingConfirmed?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"giardino-success-icon\",children:/*#__PURE__*/_jsx(FaCheck,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"giardino-success-text\",children:\"Hai prenotato con successo il giardino\"}),/*#__PURE__*/_jsx(\"div\",{className:\"giardino-info\",children:cardInfo}),(stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&stato.famiglia===famigliaSelezionata&&/*#__PURE__*/_jsxs(\"button\",{className:\"giardino-btn libera\",style:{marginTop:18,width:'90%'},onClick:()=>pubblicaStato('libero'),children:[/*#__PURE__*/_jsx(\"span\",{style:{marginRight:8,display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(FaCheck,{})}),\"Libera Giardino\"]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[cardIcon,/*#__PURE__*/_jsx(\"div\",{className:\"giardino-title\",children:cardTitle}),/*#__PURE__*/_jsx(\"div\",{className:\"giardino-info\",children:cardInfo}),(stato===null||stato===void 0?void 0:stato.stato)==='occupato'&&stato.famiglia===famigliaSelezionata&&/*#__PURE__*/_jsxs(\"button\",{className:\"giardino-btn libera\",style:{marginTop:18,width:'90%'},onClick:()=>pubblicaStato('libero'),children:[/*#__PURE__*/_jsx(\"span\",{style:{marginRight:8,display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(FaCheck,{})}),\"Libera Giardino\"]})]})}),stato&&stato.stato==='libero'&&famigliaSelezionata!=='Visualizzatore'&&!isBooking&&!bookingConfirmed&&/*#__PURE__*/_jsx(\"div\",{className:\"bottoni-row\",style:{marginTop:12},children:/*#__PURE__*/_jsxs(\"button\",{className:\"giardino-btn occupa\",onClick:handleOccupa,children:[/*#__PURE__*/_jsx(\"span\",{style:{marginRight:8,display:'flex',alignItems:'center'},children:/*#__PURE__*/_jsx(FaLeaf,{})}),\"Occupa Giardino\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mqtt-label\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mqtt-dot\"}),\" MQTT: Connesso\"]})]})});}export default App;","map":{"version":3,"names":["React","useEffect","useRef","useState","mqtt","richiediPermessoNotifiche","FaLock","FaLeaf","FaCheck","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MQTT_BROKER","TOPIC","FAMIGLIE","PUSH_SERVER_URL","formatDate","ts","d","Date","toLocaleString","App","famiglia","setFamiglia","famigliaSelezionata","setFamigliaSelezionata","stato","setStato","conn","setConn","notificheAttive","setNotificheAttive","clientRef","showUnlock","setShowUnlock","backendReady","setBackendReady","isBooking","setIsBooking","bookingConfirmed","setBookingConfirmed","bookingTimeout","registraPush","navigator","window","reg","serviceWorker","ready","resp","fetch","data","json","VAPID_PUBLIC_KEY","publicKey","sub","pushManager","subscribe","userVisibleOnly","applicationServerKey","urlBase64ToUint8Array","method","headers","body","JSON","stringify","console","log","e","warn","cancellaPush","subscription","getSubscription","endpoint","unsubscribe","toggleNotifiche","perm","success","localStorage","setItem","base64String","padding","repeat","length","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","salvata","getItem","notificheSalvate","stop","checkBackend","ok","setTimeout","interval","setInterval","catch","clearInterval","client","connect","current","on","topic","msg","parse","toString","timestamp","end","t","clearTimeout","pubblicaStato","nuovoStato","connected","payload","now","publish","retain","handleOccupa","cardClass","cardGradient","cardIcon","style","display","marginBottom","children","size","cardTitle","cardInfo","className","background","color","borderRadius","width","height","flexDirection","alignItems","justifyContent","fontSize","fontWeight","margin","boxShadow","position","minHeight","marginTop","pubblicaStatoIniziale","onClick","value","onChange","target","disabled","map","f","type","checked","marginRight"],"sources":["/home/ares-desktop/localRepo/cani/mqtt-react-demo/src/App.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport mqtt, { MqttClient } from 'mqtt';\nimport './App.css';\nimport { richiediPermessoNotifiche } from './index';\n// Importo le icone da react-icons\nimport { FaLock, FaLeaf, FaCheck } from 'react-icons/fa';\n\nconst MQTT_BROKER = 'wss://test.mosquitto.org:8081';\nconst TOPIC = 'giardino/stato';\nconst FAMIGLIE = ['ermes-ben', 'raya', 'Visualizzatore'];\nconst PUSH_SERVER_URL = 'https://cani-backend.onrender.com';\n\ntype StatoGiardino = {\n  stato: 'libero' | 'occupato';\n  famiglia: string;\n  timestamp: number;\n};\n\nfunction formatDate(ts: number) {\n  const d = new Date(ts);\n  return d.toLocaleString();\n}\n\nfunction App() {\n  const [famiglia, setFamiglia] = useState<string>('');\n  const [famigliaSelezionata, setFamigliaSelezionata] = useState<string | null>(null);\n  const [stato, setStato] = useState<StatoGiardino | null>(null);\n  const [conn, setConn] = useState<'connecting' | 'connected' | 'error'>('connecting');\n  const [notificheAttive, setNotificheAttive] = useState<boolean>(false);\n  const clientRef = useRef<MqttClient | null>(null);\n  // Stato per mostrare il pulsante di sblocco dopo 20s\n  const [showUnlock, setShowUnlock] = React.useState(false);\n  // Stato per attesa backend\n  const [backendReady, setBackendReady] = React.useState<boolean>(false);\n  const [isBooking, setIsBooking] = React.useState(false);\n  const [bookingConfirmed, setBookingConfirmed] = React.useState(false);\n  const bookingTimeout = React.useRef<NodeJS.Timeout | null>(null);\n\n  // Funzione per registrare la subscription push (ora prende la VAPID key dal backend)\n  async function registraPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        // Recupera la VAPID public key dal backend\n        const resp = await fetch(PUSH_SERVER_URL + '/vapidPublicKey');\n        const data = await resp.json();\n        const VAPID_PUBLIC_KEY = data.publicKey;\n        const sub = await reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n        });\n        // Invia la subscription al backend\n        await fetch(PUSH_SERVER_URL + '/subscribe', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(sub)\n        });\n        console.log('Push subscription inviata al backend:', JSON.stringify(sub));\n        return true;\n      } catch (e) {\n        console.warn('Push subscription error', e);\n        return false;\n      }\n    }\n    return false;\n  }\n\n  // Funzione per cancellare la subscription push\n  async function cancellaPush() {\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      const reg = await navigator.serviceWorker.ready;\n      try {\n        const subscription = await reg.pushManager.getSubscription();\n        if (subscription) {\n          // Notifica il backend della cancellazione\n          try {\n            await fetch(PUSH_SERVER_URL + '/unsubscribe', {\n              method: 'DELETE',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ endpoint: subscription.endpoint })\n            });\n          } catch (e) {\n            console.warn('Errore notifica cancellazione al backend:', e);\n          }\n          \n          await subscription.unsubscribe();\n          console.log('Push subscription cancellata');\n          return true;\n        }\n      } catch (e) {\n        console.warn('Push unsubscription error', e);\n      }\n    }\n    return false;\n  }\n\n  // Funzione per gestire l'attivazione/disattivazione delle notifiche\n  async function toggleNotifiche() {\n    if (!notificheAttive) {\n      // Attiva notifiche\n      const perm = await richiediPermessoNotifiche();\n      if (perm === 'granted') {\n        const success = await registraPush();\n        if (success) {\n          setNotificheAttive(true);\n          localStorage.setItem('notificheAttive', 'true');\n        }\n      }\n    } else {\n      // Disattiva notifiche\n      const success = await cancellaPush();\n      if (success) {\n        setNotificheAttive(false);\n        localStorage.setItem('notificheAttive', 'false');\n      }\n    }\n  }\n\n  // Funzione di utilità per VAPID key\n  function urlBase64ToUint8Array(base64String: string) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n  }\n\n  // Recupera la famiglia selezionata e lo stato notifiche da localStorage all'avvio\n  useEffect(() => {\n    const salvata = localStorage.getItem('famiglia');\n    const notificheSalvate = localStorage.getItem('notificheAttive');\n    if (salvata) {\n      setFamigliaSelezionata(salvata);\n      setFamiglia(salvata);\n    }\n    if (notificheSalvate) {\n      setNotificheAttive(notificheSalvate === 'true');\n    }\n  }, []);\n\n  // Controllo backend all'avvio\n  React.useEffect(() => {\n    let stop = false;\n    async function checkBackend() {\n      try {\n        const resp = await fetch(PUSH_SERVER_URL + '/health', { method: 'GET' });\n        if (resp.ok) {\n          setBackendReady(true);\n          return;\n        }\n      } catch {}\n      if (!stop) setTimeout(checkBackend, 3000);\n    }\n    checkBackend();\n    return () => { stop = true; };\n  }, []);\n\n  // Ping periodico per tenere sveglio il backend (ogni 5 minuti)\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      fetch(PUSH_SERVER_URL + '/health').catch(() => {});\n    }, 5 * 60 * 1000); // ogni 5 minuti\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    const client = mqtt.connect(MQTT_BROKER);\n    clientRef.current = client;\n\n    client.on('connect', () => {\n      setConn('connected');\n      client.subscribe(TOPIC);\n    });\n    client.on('error', () => {\n      setConn('connecting'); // Riprova sempre\n    });\n    client.on('message', (topic, msg) => {\n      if (topic === TOPIC) {\n        try {\n          const data = JSON.parse(msg.toString());\n          if (data.stato && data.famiglia && data.timestamp) {\n            setStato(data);\n          }\n        } catch {}\n      }\n    });\n    return () => { client.end(); };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (conn === 'connected' && stato === null) {\n      const t = setTimeout(() => setShowUnlock(true), 20000);\n      return () => clearTimeout(t);\n    } else {\n      setShowUnlock(false);\n    }\n  }, [conn, stato]);\n\n  const pubblicaStato = (nuovoStato: 'libero' | 'occupato') => {\n    if (clientRef.current && clientRef.current.connected && famigliaSelezionata) {\n      const payload: StatoGiardino = {\n        stato: nuovoStato,\n        famiglia: famigliaSelezionata,\n        timestamp: Date.now(),\n      };\n      clientRef.current.publish(TOPIC, JSON.stringify(payload), { retain: true });\n      // Aggiornamento ottimistico locale\n      setStato(payload);\n    }\n  };\n\n  // Quando clicco Occupa Giardino\n  const handleOccupa = () => {\n    setIsBooking(true);\n    setBookingConfirmed(false);\n    pubblicaStato('occupato');\n    // Se dopo 10s non arriva conferma, resetta\n    if (bookingTimeout.current) clearTimeout(bookingTimeout.current);\n    bookingTimeout.current = setTimeout(() => setIsBooking(false), 10000);\n  };\n\n  // Quando arriva il messaggio MQTT di occupazione confermata dalla propria famiglia\n  React.useEffect(() => {\n    if (isBooking && stato?.stato === 'occupato' && stato.famiglia === famigliaSelezionata) {\n      setBookingConfirmed(true);\n      setIsBooking(false);\n      if (bookingTimeout.current) clearTimeout(bookingTimeout.current);\n    }\n  }, [isBooking, stato, famigliaSelezionata]);\n\n  // Card stato giardino\n  let cardClass = 'giardino-card';\n  let cardGradient = stato && stato.stato === 'occupato'\n    ? 'giardino-card-occupato'\n    : 'giardino-card-libero';\n  let cardIcon = stato && stato.stato === 'occupato'\n    ? <span style={{display: 'block', marginBottom: 12}}><FaLock size={48} /></span>\n    : <span style={{display: 'block', marginBottom: 12}}><FaLeaf size={48} /></span>;\n  let cardTitle = stato && stato.stato === 'occupato' ? 'Giardino occupato' : 'Giardino libero';\n  let cardInfo = stato\n    ? (stato.stato === 'occupato'\n        ? `Occupato da: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`\n        : `Ultimo utilizzatore: ${stato.famiglia}\\nDal: ${formatDate(stato.timestamp)}`)\n    : '';\n\n  // Blocca tutto finché il backend non è up\n  if (!backendReady) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Avvio backend...<br />Potrebbe volerci qualche momento\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  if (conn !== 'connected') {\n    return (\n      <div className=\"App\" style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n        <header className=\"App-header\" style={{ width: '100vw', minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 0 }}>\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 32,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Connessione al broker MQTT...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di caricamento stato giardino\n  if (conn === 'connected' && stato === null) {\n    // Funzione per pubblicare uno stato iniziale retained\n    const pubblicaStatoIniziale = () => {\n      if (clientRef.current && clientRef.current.connected) {\n        const payload = {\n          stato: 'libero',\n          famiglia: 'iniziale',\n          timestamp: Date.now(),\n        };\n        clientRef.current.publish(TOPIC, JSON.stringify(payload), { retain: true });\n      }\n    };\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 260,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            Recupero stato giardino...\n            <div style={{ marginTop: 24, fontSize: 18, color: '#aaa' }}>Attendere...</div>\n            {showUnlock && (\n              <button style={{ marginTop: 32, fontSize: 18 }} onClick={pubblicaStatoIniziale}>\n                Sblocca (pubblica stato iniziale)\n              </button>\n            )}\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  // Schermata di selezione famiglia\n  if (!famigliaSelezionata) {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <div style={{\n            background: '#222',\n            color: '#fff',\n            borderRadius: 16,\n            width: 400,\n            height: 220,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: 28,\n            fontWeight: 'bold',\n            margin: '0 auto',\n            boxShadow: '0 4px 24px #0006',\n            position: 'relative',\n          }}>\n            <div style={{ marginBottom: 32 }}>Seleziona la tua famiglia:</div>\n            <select\n              value={famiglia}\n              onChange={e => setFamiglia(e.target.value)}\n              style={{ fontSize: 22, marginBottom: 24 }}\n            >\n              <option value=\"\" disabled>-- Scegli --</option>\n              {FAMIGLIE.map(f => (\n                <option key={f} value={f}>\n                  {f === 'Visualizzatore' ? 'Visualizzatore (solo lettura)' : f}\n                </option>\n              ))}\n            </select>\n            <button\n              style={{ fontSize: 20, padding: '10px 24px' }}\n              disabled={!famiglia}\n              onClick={async () => {\n                setFamigliaSelezionata(famiglia);\n                localStorage.setItem('famiglia', famiglia);\n              }}\n            >\n              Conferma\n            </button>\n          </div>\n        </header>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <div className=\"famiglia-label\">\n          Famiglia selezionata:<br />\n          <span className=\"famiglia-nome\">{famigliaSelezionata}</span>\n        </div>\n        <div className=\"notifiche-card\">\n          <span>Notifiche Push</span>\n          <div className=\"notifiche-switch\">\n            <label className=\"switch\">\n              <input\n                type=\"checkbox\"\n                checked={notificheAttive}\n                onChange={toggleNotifiche}\n              />\n              <span className=\"slider round\"></span>\n            </label>\n            <span className=\"notifiche-stato\">{notificheAttive ? 'Attive' : 'Spente'}</span>\n          </div>\n        </div>\n        {/* Card con animazione e contenuto dinamico */}\n        <div className={`giardino-card ${cardGradient} ${(isBooking || bookingConfirmed || stato?.stato === 'occupato') ? 'giardino-card-expanded' : ''} ${(isBooking || bookingConfirmed) ? 'giardino-card-booking' : ''} ${isBooking ? 'giardino-card-loading' : ''} ${bookingConfirmed ? 'giardino-card-success' : ''}`}> \n          {isBooking ? (\n            <>\n              <div className=\"giardino-loader\" />\n              <div className=\"giardino-info\" style={{marginTop: 18, fontWeight: 500, color: '#fff'}}>\n                La tua richiesta sta venendo elaborata...\n              </div>\n            </>\n          ) : bookingConfirmed ? (\n            <>\n              <div className=\"giardino-success-icon\"><FaCheck /></div>\n              <div className=\"giardino-success-text\">Hai prenotato con successo il giardino</div>\n              <div className=\"giardino-info\">{cardInfo}</div>\n              {stato?.stato === 'occupato' && stato.famiglia === famigliaSelezionata && (\n                <button\n                  className=\"giardino-btn libera\"\n                  style={{marginTop: 18, width: '90%'}}\n                  onClick={() => pubblicaStato('libero')}\n                >\n                  <span style={{marginRight: 8, display: 'flex', alignItems: 'center'}}><FaCheck /></span>Libera Giardino\n                </button>\n              )}\n            </>\n          ) : (\n            <>\n              {cardIcon}\n              <div className=\"giardino-title\">{cardTitle}</div>\n              <div className=\"giardino-info\">{cardInfo}</div>\n              {/* Se occupato e la famiglia è quella giusta, mostra il pulsante dentro la card */}\n              {stato?.stato === 'occupato' && stato.famiglia === famigliaSelezionata && (\n                <button\n                  className=\"giardino-btn libera\"\n                  style={{marginTop: 18, width: '90%'}}\n                  onClick={() => pubblicaStato('libero')}\n                >\n                  <span style={{marginRight: 8, display: 'flex', alignItems: 'center'}}><FaCheck /></span>Libera Giardino\n                </button>\n              )}\n            </>\n          )}\n        </div>\n        {/* Se giardino libero, mostra solo il pulsante Occupa sotto la card, ma non durante booking */}\n        {stato && stato.stato === 'libero' && famigliaSelezionata !== 'Visualizzatore' && !isBooking && !bookingConfirmed && (\n          <div className=\"bottoni-row\" style={{marginTop: 12}}>\n            <button\n              className=\"giardino-btn occupa\"\n              onClick={handleOccupa}\n            >\n              <span style={{marginRight: 8, display: 'flex', alignItems: 'center'}}><FaLeaf /></span>Occupa Giardino\n            </button>\n          </div>\n        )}\n        <div className=\"mqtt-label\">\n          <span className=\"mqtt-dot\" /> MQTT: Connesso\n        </div>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}